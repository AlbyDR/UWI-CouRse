Statistics Course - UWI
================
AlbyDR
2021-04-16

## Example 2.3: Exploratory Data Analysis

``` r
packages_list2.3 <- c("tidyverse", "lubridate", "kableExtra", "summarytools", "corrr", "GGally",
                      "minerva", "magrittr", "colorspace")
```

new.packages &lt;- packages\_list2.3\[!(packages\_list2.3 %in%
installed.packages()\[,“Package”\])\] if(length(new.packages))
install.packages(new.packages) \#’ update.packages &lt;-
packages\_list2.3\[(packages\_list2.3 %in%
old.packages()\[,“Package”\])\] if(length(update.packages))
install.packages(update.packages)

``` r
invisible(lapply(packages_list2.3, library, character.only = T, quietly = TRUE, warn.conflicts = F))
```

    ## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --

    ## v ggplot2 3.3.3     v purrr   0.3.4
    ## v tibble  3.1.0     v dplyr   1.0.5
    ## v tidyr   1.1.3     v stringr 1.4.0
    ## v readr   1.4.0     v forcats 0.5.1

    ## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

    ## Registered S3 method overwritten by 'pryr':
    ##   method      from
    ##   print.bytes Rcpp

    ## For best results, restart R session and update pander using devtools:: or remotes::install_github('rapporter/pander')

    ## Registered S3 method overwritten by 'GGally':
    ##   method from   
    ##   +.gg   ggplot2

``` r
DWD_precipitation <- read_rds("DWD_precipitation.rds")
```

Tidy data and vector types <dbl> , <chr> and <fct>

``` r
DWD_precipitation
```

    ## # A tibble: 236,566 x 10
    ##    timestamp           precip_mm precip_h cloud_cover rel_humidity
    ##    <dttm>                  <dbl>    <dbl>       <dbl>        <dbl>
    ##  1 1997-01-01 00:00:00         0        0           0         90.5
    ##  2 1997-01-01 01:00:00         0        0           0         88.2
    ##  3 1997-01-01 02:00:00         0        0           0         89.7
    ##  4 1997-01-01 03:00:00         0        0           0         91.2
    ##  5 1997-01-01 04:00:00         0        0           0         87.4
    ##  6 1997-01-01 05:00:00         0        0           0         91.1
    ##  7 1997-01-01 06:00:00         0        0           0         86.5
    ##  8 1997-01-01 07:00:00         0        0           0         87.3
    ##  9 1997-01-01 08:00:00         0        0           0         89.5
    ## 10 1997-01-01 09:00:00         0        0           0         88.8
    ## # ... with 236,556 more rows, and 5 more variables: sunlight_times <chr>,
    ## #   prec.window <dbl>, cloud_type <fct>, day_night <dbl>, air_temp <dbl>

Lets have a general summary (base function)

``` r
summary(DWD_precipitation)
```

    ##    timestamp                     precip_mm          precip_h     
    ##  Min.   :1997-01-01 00:00:00   Min.   : 0.0000   Min.   :0.0000  
    ##  1st Qu.:2003-10-01 05:15:00   1st Qu.: 0.0000   1st Qu.:0.0000  
    ##  Median :2010-06-30 10:30:00   Median : 0.0000   Median :0.0000  
    ##  Mean   :2010-04-10 16:39:44   Mean   : 0.0647   Mean   :0.2098  
    ##  3rd Qu.:2017-03-29 15:45:00   3rd Qu.: 0.0000   3rd Qu.:0.0000  
    ##  Max.   :2020-12-31 00:00:00   Max.   :31.7000   Max.   :1.0000  
    ##                                NA's   :1410      NA's   :1409    
    ##   cloud_cover      rel_humidity    sunlight_times      prec.window    
    ##  Min.   :-1.000   Min.   : 11.90   Length:236566      Min.   :  0.00  
    ##  1st Qu.: 3.000   1st Qu.: 65.50   Class :character   1st Qu.:  1.00  
    ##  Median : 7.000   Median : 82.50   Mode  :character   Median : 12.00  
    ##  Mean   : 5.298   Mean   : 77.57                      Mean   : 34.69  
    ##  3rd Qu.: 8.000   3rd Qu.: 93.60                      3rd Qu.: 42.00  
    ##  Max.   : 8.000   Max.   :100.00                      Max.   :400.00  
    ##  NA's   :103      NA's   :133                                         
    ##          cloud_type      day_night         air_temp     
    ##  Cumulus      :70507   Min.   :0.0000   Min.   :-19.60  
    ##  Stratus      :48131   1st Qu.:0.0000   1st Qu.:  4.00  
    ##  Stratocumulus:25614   Median :1.0000   Median :  9.90  
    ##  Cirrus       :19708   Mean   :0.6911   Mean   : 10.16  
    ##  Cirrocumulus :18479   3rd Qu.:1.0000   3rd Qu.: 16.10  
    ##  (Other)      :54024   Max.   :1.0000   Max.   : 37.70  
    ##  NA's         :  103

Notice that the <chr> do not show and cloud\_cover statistics make no
sense as <bdl> but cloud\_type <fct> present the sum of the main
categories or levels.

For categorical variables (chr and fct) make sense to check frequencies
(abs, %)

``` r
freq(DWD_precipitation$sunlight_times, cumul = F, report.nas = FALSE, headings = FALSE) #
```

    ## 
    ##                                Freq        %
    ## -------------------------- -------- --------
    ##                       Dawn    20909     8.84
    ##                       Dusk    21495     9.09
    ##       Goldenhour_afternoon     8626     3.65
    ##         Goldenhour_morning     8417     3.56
    ##                      Night    73082    30.89
    ##                       Noon     9857     4.17
    ##                 Sun_rising    43856    18.54
    ##                Sun_setting    50324    21.27
    ##                      Total   236566   100.00

``` r
freq(DWD_precipitation$cloud_type, plain.ascii = FALSE, style = "rmarkdown")
```

    ## ### Frequencies  
    ## #### DWD_precipitation$cloud_type  
    ## **Type:** Factor  
    ## 
    ## |            &nbsp; |   Freq | % Valid | % Valid Cum. | % Total | % Total Cum. |
    ## |------------------:|-------:|--------:|-------------:|--------:|-------------:|
    ## | **by_instrument** |   1864 |   0.788 |        0.788 |   0.788 |        0.788 |
    ## |        **Cirrus** |  19708 |   8.334 |        9.123 |   8.331 |        9.119 |
    ## |  **Cirrocumulus** |  18479 |   7.815 |       16.938 |   7.811 |       16.930 |
    ## |  **Cirrostratus** |  14302 |   6.048 |       22.986 |   6.046 |       22.976 |
    ## |   **Altocumulus** |  13013 |   5.503 |       28.489 |   5.501 |       28.477 |
    ## |   **Altostratus** |  10426 |   4.409 |       32.898 |   4.407 |       32.884 |
    ## |  **Nimbostratus** |  14419 |   6.098 |       38.996 |   6.095 |       38.979 |
    ## | **Stratocumulus** |  25614 |  10.832 |       49.828 |  10.827 |       49.806 |
    ## |       **Stratus** |  48131 |  20.355 |       70.183 |  20.346 |       70.152 |
    ## |       **Cumulus** |  70507 |  29.817 |      100.000 |  29.804 |       99.956 |
    ## |  **Cumulonimbus** |      0 |   0.000 |      100.000 |   0.000 |       99.956 |
    ## |        **\<NA\>** |    103 |         |              |   0.044 |      100.000 |
    ## |         **Total** | 236566 | 100.000 |      100.000 | 100.000 |      100.000 |

If you make a cross table between to categorical

``` r
ctable(DWD_precipitation$cloud_type, DWD_precipitation$precip_h, prop = "r")
```

    ## Cross-Tabulation, Row Proportions  
    ## cloud_type * precip_h  
    ## Data Frame: DWD_precipitation  
    ## 
    ## --------------- ---------- ---------------- --------------- -------------- -----------------
    ##                   precip_h                0               1           <NA>             Total
    ##      cloud_type                                                                             
    ##   by_instrument                1352 (72.5%)     492 (26.4%)     20 ( 1.1%)     1864 (100.0%)
    ##          Cirrus               19594 (99.4%)      22 ( 0.1%)     92 ( 0.5%)    19708 (100.0%)
    ##    Cirrocumulus               18297 (99.0%)      48 ( 0.3%)    134 ( 0.7%)    18479 (100.0%)
    ##    Cirrostratus               14055 (98.3%)     172 ( 1.2%)     75 ( 0.5%)    14302 (100.0%)
    ##     Altocumulus               12626 (97.0%)     309 ( 2.4%)     78 ( 0.6%)    13013 (100.0%)
    ##     Altostratus                9942 (95.4%)     419 ( 4.0%)     65 ( 0.6%)    10426 (100.0%)
    ##    Nimbostratus               13460 (93.3%)     897 ( 6.2%)     62 ( 0.4%)    14419 (100.0%)
    ##   Stratocumulus               22734 (88.8%)    2745 (10.7%)    135 ( 0.5%)    25614 (100.0%)
    ##         Stratus               37636 (78.2%)   10234 (21.3%)    261 ( 0.5%)    48131 (100.0%)
    ##         Cumulus               36090 (51.2%)   33963 (48.2%)    454 ( 0.6%)    70507 (100.0%)
    ##    Cumulonimbus                   0 ( 0.0%)       0 ( 0.0%)      0 ( 0.0%)        0 (  0.0%)
    ##            <NA>                  42 (40.8%)      28 (27.2%)     33 (32.0%)      103 (100.0%)
    ##           Total              185828 (78.6%)   49329 (20.9%)   1409 ( 0.6%)   236566 (100.0%)
    ## --------------- ---------- ---------------- --------------- -------------- -----------------

``` r
ggplot(DWD_precipitation) +
  geom_jitter(aes(y = cloud_type, x = precip_h))
```

    ## Warning: Removed 1409 rows containing missing values (geom_point).

![](2.3_Exploratory_analysis_files/figure-gfm/unnamed-chunk-9-1.png)<!-- -->

While for quantitative variables (continuous and discrete) we can run
descriptive statistics

``` r
descr(DWD_precipitation$precip_mm, stats = "all") 
```

    ## Descriptive Statistics  
    ## DWD_precipitation$precip_mm  
    ## N: 236566  
    ## 
    ##                     precip_mm
    ## ----------------- -----------
    ##              Mean        0.06
    ##           Std.Dev        0.44
    ##               Min        0.00
    ##                Q1        0.00
    ##            Median        0.00
    ##                Q3        0.00
    ##               Max       31.70
    ##               MAD        0.00
    ##               IQR        0.00
    ##                CV        6.81
    ##          Skewness       21.24
    ##       SE.Skewness        0.01
    ##          Kurtosis      800.96
    ##           N.Valid   235156.00
    ##         Pct.Valid       99.40

Note: including `%>% tb()` in the end to transpose the table and
`stats = "all"` to show more statistics

You can compare the difference between groups and see all quantitative
variables together

``` r
# stby(data = DWD_precipitation, 
#      INDICES = DWD_precipitation$sunlight_times, 
#      FUN = descr, stats = "common", transpose = F)
```

Also use pipe to refine it

``` r
DWD_precipitation %>% 
  mutate(day_night = fct_collapse(sunlight_times, 
                                  "Day" = unique(sunlight_times)[-1])) %>%
  group_by(day_night = day_night) %>%
  descr(stats = "common") %>%
  print(n = "inf")
```

    ## Non-numerical variable(s) ignored: timestamp, sunlight_times, cloud_type

    ## Descriptive Statistics  
    ## DWD_precipitation  
    ## Group: day_night = Day  
    ## N: 163484  
    ## 
    ##                    air_temp   cloud_cover   prec.window    precip_h   precip_mm   rel_humidity
    ## --------------- ----------- ------------- ------------- ----------- ----------- --------------
    ##            Mean       11.91          5.34         36.13        0.21        0.07          73.71
    ##         Std.Dev        8.20          2.67         58.53        0.41        0.48          20.21
    ##             Min      -19.60         -1.00          0.00        0.00        0.00          11.90
    ##          Median       12.10          6.00         14.00        0.00        0.00          77.50
    ##             Max       37.70          8.00        400.00        1.00       31.70         100.00
    ##         N.Valid   163484.00     163417.00     163484.00   162554.00   162553.00      163401.00
    ##       Pct.Valid      100.00         99.96        100.00       99.43       99.43          99.95
    ## 
    ## Group: day_night = Night  
    ## N: 73082  
    ## 
    ##                   air_temp   cloud_cover   prec.window   precip_h   precip_mm   rel_humidity
    ## --------------- ---------- ------------- ------------- ---------- ----------- --------------
    ##            Mean       6.25          5.19         31.47       0.22        0.06          86.19
    ##         Std.Dev       6.66          3.13         53.58       0.41        0.35          12.28
    ##             Min     -18.90         -1.00          0.00       0.00        0.00          29.20
    ##          Median       5.80          7.00         10.00       0.00        0.00          89.50
    ##             Max      27.80          8.00        400.00       1.00       21.60         100.00
    ##         N.Valid   73082.00      73046.00      73082.00   72603.00    72603.00       73032.00
    ##       Pct.Valid     100.00         99.95        100.00      99.34       99.34          99.93

``` r
stby(DWD_precipitation[,c(2,5,8)], DWD_precipitation$precip_h, descr, stats = "fivenum") %>%
  tb(order = 3) %>%
  kable(format = "html", digits = 2) %>%
  collapse_rows(columns = 1, valign = "top")
```

<table>
<thead>
<tr>
<th style="text-align:left;">
variable
</th>
<th style="text-align:left;">
precip\_h
</th>
<th style="text-align:right;">
min
</th>
<th style="text-align:right;">
q1
</th>
<th style="text-align:right;">
med
</th>
<th style="text-align:right;">
q3
</th>
<th style="text-align:right;">
max
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
precip\_mm
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
<tr>
<td style="text-align:left;">
precip\_mm
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
31.7
</td>
</tr>
<tr>
<td style="text-align:left;">
rel\_humidity
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
11.9
</td>
<td style="text-align:right;">
61.1
</td>
<td style="text-align:right;">
78.5
</td>
<td style="text-align:right;">
90.9
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
<tr>
<td style="text-align:left;">
rel\_humidity
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
17.9
</td>
<td style="text-align:right;">
84.0
</td>
<td style="text-align:right;">
93.3
</td>
<td style="text-align:right;">
97.5
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
</tbody>
</table>

Or you can have a general summary (descriptive statistics) for the data
only by doing

``` r
#view(dfSummary(DWD_precipitation[,-4])) # excluding the variable four (cloud_cover)
#view(dfSummary(DWD_temperature))
```

``` r
# for markdown
print(dfSummary(DWD_precipitation[,-4], graph.magnif = 0.75), method = 'render', 
      valid.col = FALSE, tmp.img.dir =  NA)
```

<!--html_preserve-->
<div class="container st-container">
<h3>
Data Frame Summary
</h3>
<h4>
DWD\_precipitation
</h4>
<strong>Dimensions</strong>: 236566 x 9
<br/><strong>Duplicates</strong>: 19154 <br/>
<table class="table table-striped table-bordered st-table st-table-striped st-table-bordered st-multiline ">
<thead>
<tr>
<th align="center" class="st-protect-top-border">
<strong>No</strong>
</th>
<th align="center" class="st-protect-top-border">
<strong>Variable</strong>
</th>
<th align="center" class="st-protect-top-border">
<strong>Stats / Values</strong>
</th>
<th align="center" class="st-protect-top-border">
<strong>Freqs (% of Valid)</strong>
</th>
<th align="center" class="st-protect-top-border">
<strong>Graph</strong>
</th>
<th align="center" class="st-protect-top-border">
<strong>Missing</strong>
</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">
1
</td>
<td align="left">
timestamp \[POSIXct, POSIXt\]
</td>
<td align="left">
min : 1997-01-01 med : 2010-06-30 10:30:00 max : 2020-12-31 range : 23y
11m 30d
</td>
<td align="left" style="vertical-align:middle">
210361 distinct values
</td>
<td align="left" style="vertical-align:middle;padding:0;background-color:transparent">
<img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAHQAAABUBAMAAAChGA4iAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAD1BMVEX////9/v2mpqbw8PD///+xh0SBAAAAAnRSTlMAAHaTzTgAAAABYktHRACIBR1IAAAAB3RJTUUH5QQQDzgIPdyiOgAAAFdJREFUWMPt07EJACAMRNGsoCPEDcz+uylWClokIBb+I80RXpeI/JXkTFbVKDWrUCgUCoVCoVDoFaquLLT0NsbKmLrtU4FCoW9of94oPWyh0NghuiN/pQGc78ZxIFU7hQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMS0wNC0xNlQxNTo1NjowOCswMDowMOltbXAAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjEtMDQtMTZUMTU6NTY6MDgrMDA6MDCYMNXMAAAAAElFTkSuQmCC">
</td>
<td align="center">
0 (0.0%)
</td>
</tr>
<tr>
<td align="center">
2
</td>
<td align="left">
precip\_mm \[numeric\]
</td>
<td align="left">
Mean (sd) : 0.1 (0.4) min &lt; med &lt; max: 0 &lt; 0 &lt; 31.7 IQR (CV)
: 0 (6.8)
</td>
<td align="left" style="vertical-align:middle">
137 distinct values
</td>
<td align="left" style="vertical-align:middle;padding:0;background-color:transparent">
<img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAHQAAABUBAMAAAChGA4iAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAD1BMVEX////9/v2mpqbw8PD///+xh0SBAAAAAnRSTlMAAHaTzTgAAAABYktHRACIBR1IAAAAB3RJTUUH5QQQDzgIPdyiOgAAADdJREFUWMPtyzEBACAMA7BZQAJFAv698WAA3iV/qnpJMsejW9feqqqqqqqqqqqqqqqqjWo+VC8Hmywns5JiDugAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjEtMDQtMTZUMTU6NTY6MDgrMDA6MDDpbW1wAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIxLTA0LTE2VDE1OjU2OjA4KzAwOjAwmDDVzAAAAABJRU5ErkJggg==">
</td>
<td align="center">
1410 (0.6%)
</td>
</tr>
<tr>
<td align="center">
3
</td>
<td align="left">
precip\_h \[numeric\]
</td>
<td align="left">
Min : 0 Mean : 0.2 Max : 1
</td>
<td align="left" style="padding:0;vertical-align:middle">
<table style="border-collapse:collapse;border:none;margin:0">
<tr style="background-color:transparent">
<td style="padding:0 2px 0 7px;margin:0;border:0" align="right">
0
</td>
<td style="padding:0 2px;border:0;" align="left">
:
</td>
<td style="padding:0 4px 0 6px;margin:0;border:0" align="right">
185828
</td>
<td style="padding:0;border:0" align="left">
(
</td>
<td style="padding:0 2px;margin:0;border:0" align="right">
79.0%
</td>
<td style="padding:0 4px 0 0;border:0" align="left">
)
</td>
</tr>
<tr style="background-color:transparent">
<td style="padding:0 2px 0 7px;margin:0;border:0" align="right">
1
</td>
<td style="padding:0 2px;border:0;" align="left">
:
</td>
<td style="padding:0 4px 0 6px;margin:0;border:0" align="right">
49329
</td>
<td style="padding:0;border:0" align="left">
(
</td>
<td style="padding:0 2px;margin:0;border:0" align="right">
21.0%
</td>
<td style="padding:0 4px 0 0;border:0" align="left">
)
</td>
</tr>
</table>
</td>
<td align="left" style="vertical-align:middle;padding:0;background-color:transparent">
<img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAGUAAAAqBAMAAABYXIhFAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAD1BMVEX////9/v2mpqbw8PD///+xh0SBAAAAAnRSTlMAAHaTzTgAAAABYktHRACIBR1IAAAAB3RJTUUH5QQQDzgJStuSrAAAADpJREFUSMdjYBh+QIkEoADVo2xMPBjVM6pnqOghJy8IkgAEKNCDbDexepDCwGhUz6ie4aKHnLwwnAAAgLHUOwq+BesAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjEtMDQtMTZUMTU6NTY6MDkrMDA6MDBPGmbEAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIxLTA0LTE2VDE1OjU2OjA5KzAwOjAwPkfeeAAAAABJRU5ErkJggg==">
</td>
<td align="center">
1409 (0.6%)
</td>
</tr>
<tr>
<td align="center">
4
</td>
<td align="left">
rel\_humidity \[numeric\]
</td>
<td align="left">
Mean (sd) : 77.6 (19) min &lt; med &lt; max: 11.9 &lt; 82.5 &lt; 100 IQR
(CV) : 28.1 (0.2)
</td>
<td align="left" style="vertical-align:middle">
841 distinct values
</td>
<td align="left" style="vertical-align:middle;padding:0;background-color:transparent">
<img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAHQAAABUBAMAAAChGA4iAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAD1BMVEX////9/v2mpqbw8PD///+xh0SBAAAAAnRSTlMAAHaTzTgAAAABYktHRACIBR1IAAAAB3RJTUUH5QQQDzgJStuSrAAAAKRJREFUWMPt1d0NgCAMBGBWkBFgA7v/biKGPzXRu0QTbft8XxoILc7pqgksH0Jgqchs1KhRo0Z10fRrsDTKbPRvNL0HlkYRHTTfEUez00DLHRG0uG9Q3w4K0+beoj7ve47KGv4K3Q7K0exwWlsStDiUdi1RGpuDaP0hcFozIO0XLkj7DEL9uL8gOmZu03E2MTrE7tPDlAB0H3ueng3YNQ1EOV21AI7ghpWa5vgwAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIxLTA0LTE2VDE1OjU2OjA5KzAwOjAwTxpmxAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMS0wNC0xNlQxNTo1NjowOSswMDowMD5H3ngAAAAASUVORK5CYII=">
</td>
<td align="center">
133 (0.1%)
</td>
</tr>
<tr>
<td align="center">
5
</td>
<td align="left">
sunlight\_times \[character\]
</td>
<td align="left">

1.  Dawn
2.  Dusk
3.  Goldenhour\_afternoon
4.  Goldenhour\_morning
5.  Night
6.  Noon
7.  Sun\_rising
8.  Sun\_setting
    </td>
    <td align="left" style="padding:0;vertical-align:middle">
    <table style="border-collapse:collapse;border:none;margin:0">
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    20909
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    8.8%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    21495
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    9.1%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    8626
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    3.6%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    8417
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    3.6%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    73082
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    30.9%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    9857
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    4.2%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    43856
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    18.5%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    50324
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    21.3%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    </table>
    </td>
    <td align="left" style="vertical-align:middle;padding:0;background-color:transparent">
    <img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAC8AAACVBAMAAAA6WL6MAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAD1BMVEX////9/v2mpqbw8PD///+xh0SBAAAAAnRSTlMAAHaTzTgAAAABYktHRACIBR1IAAAAB3RJTUUH5QQQDzgJStuSrAAAAHZJREFUSMftlNEJgDAMBTuC3cCmGzT776aCxRKMoiZS5d3vfQTelYbwDrSQ4sawiswzEE5CnT1KTgUKfr9g2heZIfyEOjsK9iUMQx0UFIztB9ACcV2o694J1eMT/b0w/SwrSR6vQNgLdfYnBYmU41wgrIU6uzcT+QoTC1Xe0yQAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjEtMDQtMTZUMTU6NTY6MDkrMDA6MDBPGmbEAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIxLTA0LTE2VDE1OjU2OjA5KzAwOjAwPkfeeAAAAABJRU5ErkJggg==">
    </td>
    <td align="center">
    0 (0.0%)
    </td>
    </tr>
    <tr>
    <td align="center">
    6
    </td>
    <td align="left">
    prec.window \[numeric\]
    </td>
    <td align="left">
    Mean (sd) : 34.7 (57.1) min &lt; med &lt; max: 0 &lt; 12 &lt; 400
    IQR (CV) : 41 (1.6)
    </td>
    <td align="left" style="vertical-align:middle">
    401 distinct values
    </td>
    <td align="left" style="vertical-align:middle;padding:0;background-color:transparent">
    <img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAHQAAABUBAMAAAChGA4iAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAD1BMVEX////9/v2mpqbw8PD///+xh0SBAAAAAnRSTlMAAHaTzTgAAAABYktHRACIBR1IAAAAB3RJTUUH5QQQDzgJStuSrAAAAGxJREFUWMPt18ENgCAMheGu4Ag+N7D776aJJBqBSDkR+d+xyQdpaA+YzRVJSzSJbr5DoVAoFAqFQqFQ6N+otPZSd+jANPj/fdLgSA1BI+2+qAcuzmnzBuW0+ZFK9Or501fo7StHnOVE1RGbKwdsWDC/wvCQLgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMS0wNC0xNlQxNTo1NjowOSswMDowME8aZsQAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjEtMDQtMTZUMTU6NTY6MDkrMDA6MDA+R954AAAAAElFTkSuQmCC">
    </td>
    <td align="center">
    0 (0.0%)
    </td>
    </tr>
    <tr>
    <td align="center">
    7
    </td>
    <td align="left">
    cloud\_type \[factor\]
    </td>
    <td align="left">

    1.  by\_instrument
9.  Cirrus
10. Cirrocumulus
11. Cirrostratus
12. Altocumulus
13. Altostratus
14. Nimbostratus
15. Stratocumulus
16. Stratus
17. Cumulus
18. Cumulonimbus
    </td>
    <td align="left" style="padding:0;vertical-align:middle">
    <table style="border-collapse:collapse;border:none;margin:0">
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    1864
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    0.8%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    19708
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    8.3%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    18479
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    7.8%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    14302
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    6.0%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    13013
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    5.5%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    10426
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    4.4%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    14419
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    6.1%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    25614
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    10.8%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    48131
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    20.4%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    70507
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    29.8%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 5px 0 7px;margin:0;border:0" align="right">
    0
    </td>
    <td style="padding:0 2px 0 0;border:0;" align="left">
    (
    </td>
    <td style="padding:0;border:0" align="right">
    0.0%
    </td>
    <td style="padding:0 4px 0 2px;border:0" align="left">
    )
    </td>
    </tr>
    </table>
    </td>
    <td align="left" style="vertical-align:middle;padding:0;background-color:transparent">
    <img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAC4AAADKBAMAAAAoQm+QAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAD1BMVEX////9/v2mpqbw8PD///+xh0SBAAAAAnRSTlMAAHaTzTgAAAABYktHRACIBR1IAAAAB3RJTUUH5QQQDzgJStuSrAAAAJpJREFUWMPt1bsRgCAQBFBboASgA+i/N0cNBGQZ7viY7IUvOWYX8TjWjzPF0Le6Ebq7puI+xhjo0xzlrOnLgr10uaM8pb20+qq5L64Jvc9RnopeLNhLn+goZ0VfVffFNaGPOcpZ0RffvQ0+8T3MP9V3b/7npHc5ylPaS7uvZEl2nuRQ9C5HeQ708sx37z2BPuQoZ2lflv6rr5wTdUpHSWqWFIwAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjEtMDQtMTZUMTU6NTY6MDkrMDA6MDBPGmbEAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIxLTA0LTE2VDE1OjU2OjA5KzAwOjAwPkfeeAAAAABJRU5ErkJggg==">
    </td>
    <td align="center">
    103 (0.0%)
    </td>
    </tr>
    <tr>
    <td align="center">
    8
    </td>
    <td align="left">
    day\_night \[numeric\]
    </td>
    <td align="left">
    Min : 0 Mean : 0.7 Max : 1
    </td>
    <td align="left" style="padding:0;vertical-align:middle">
    <table style="border-collapse:collapse;border:none;margin:0">
    <tr style="background-color:transparent">
    <td style="padding:0 2px 0 7px;margin:0;border:0" align="right">
    0
    </td>
    <td style="padding:0 2px;border:0;" align="left">
    :
    </td>
    <td style="padding:0 4px 0 6px;margin:0;border:0" align="right">
    73082
    </td>
    <td style="padding:0;border:0" align="left">
    (
    </td>
    <td style="padding:0 2px;margin:0;border:0" align="right">
    30.9%
    </td>
    <td style="padding:0 4px 0 0;border:0" align="left">
    )
    </td>
    </tr>
    <tr style="background-color:transparent">
    <td style="padding:0 2px 0 7px;margin:0;border:0" align="right">
    1
    </td>
    <td style="padding:0 2px;border:0;" align="left">
    :
    </td>
    <td style="padding:0 4px 0 6px;margin:0;border:0" align="right">
    163484
    </td>
    <td style="padding:0;border:0" align="left">
    (
    </td>
    <td style="padding:0 2px;margin:0;border:0" align="right">
    69.1%
    </td>
    <td style="padding:0 4px 0 0;border:0" align="left">
    )
    </td>
    </tr>
    </table>
    </td>
    <td align="left" style="vertical-align:middle;padding:0;background-color:transparent">
    <img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAFoAAAAqBAMAAADBpFHwAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAD1BMVEX////9/v2mpqbw8PD///+xh0SBAAAAAnRSTlMAAHaTzTgAAAABYktHRACIBR1IAAAAB3RJTUUH5QQQDzgK09LDFgAAADtJREFUOMtjYBi6QAkdKApiA1DVysZoYFT1qGo6qyYtxQoSB8hSrUQcwOVLrMBoVPWoapqpJi3FDkUAAI6CxtEZtS0UAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIxLTA0LTE2VDE1OjU2OjEwKzAwOjAwFigjiQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMS0wNC0xNlQxNTo1NjoxMCswMDowMGd1mzUAAAAASUVORK5CYII=">
    </td>
    <td align="center">
    0 (0.0%)
    </td>
    </tr>
    <tr>
    <td align="center">
    9
    </td>
    <td align="left">
    air\_temp \[numeric\]
    </td>
    <td align="left">
    Mean (sd) : 10.2 (8.2) min &lt; med &lt; max: -19.6 &lt; 9.9 &lt;
    37.7 IQR (CV) : 12.1 (0.8)
    </td>
    <td align="left" style="vertical-align:middle">
    564 distinct values
    </td>
    <td align="left" style="vertical-align:middle;padding:0;background-color:transparent">
    <img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAHQAAABUBAMAAAChGA4iAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAD1BMVEX////9/v2mpqbw8PD///+xh0SBAAAAAnRSTlMAAHaTzTgAAAABYktHRACIBR1IAAAAB3RJTUUH5QQQDzgK09LDFgAAAItJREFUWMPt19sJwCAMBVBX0A2abNDsv1sNaKloX6Ggbe8FPwQPKqJB5/4V30qgGL+bQyoicx+qi55sNDZ5A9Utko1yYqCjU2revkuUm1cIFBQUFBS0J9W6VtOq2rUo59EFrWYGBQUFfZIW38p7VDtj0ZDfYAPNIz9E17Pd0JD+2CeU88yJkiHuX1kAZYLLAuW/lV0AAAAldEVYdGRhdGU6Y3JlYXRlADIwMjEtMDQtMTZUMTU6NTY6MTArMDA6MDAWKCOJAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIxLTA0LTE2VDE1OjU2OjEwKzAwOjAwZ3WbNQAAAABJRU5ErkJggg==">
    </td>
    <td align="center">
    0 (0.0%)
    </td>
    </tr>
    </tbody>
    </table>
    <p>
    Generated by
    <a href='https://github.com/dcomtois/summarytools'>summarytools</a>
    0.9.9 (<a href='https://www.r-project.org/'>R</a> version
    4.0.5)<br/>2021-04-16
    </p>
    </div>
    <!--/html_preserve-->

Lets check the statistics

``` r
descr(DWD_precipitation[,c(2,3,5,7,9)], stats = "all")
```

    ## Descriptive Statistics  
    ## DWD_precipitation  
    ## N: 236566  
    ## 
    ##                     day_night   prec.window    precip_h   precip_mm   rel_humidity
    ## ----------------- ----------- ------------- ----------- ----------- --------------
    ##              Mean        0.69         34.69        0.21        0.06          77.57
    ##           Std.Dev        0.46         57.09        0.41        0.44          19.03
    ##               Min        0.00          0.00        0.00        0.00          11.90
    ##                Q1        0.00          1.00        0.00        0.00          65.50
    ##            Median        1.00         12.00        0.00        0.00          82.50
    ##                Q3        1.00         42.00        0.00        0.00          93.60
    ##               Max        1.00        400.00        1.00       31.70         100.00
    ##               MAD        0.00         17.79        0.00        0.00          18.98
    ##               IQR        1.00         41.00        0.00        0.00          28.10
    ##                CV        0.67          1.65        1.94        6.81           0.25
    ##          Skewness       -0.83          3.16        1.43       21.24          -0.84
    ##       SE.Skewness        0.01          0.01        0.01        0.01           0.01
    ##          Kurtosis       -1.32         12.74        0.03      800.96          -0.19
    ##           N.Valid   236566.00     236566.00   235157.00   235156.00      236433.00
    ##         Pct.Valid      100.00        100.00       99.40       99.40          99.94

**all symmetric?** not at all

**CV** is variation coefficient=std\_dev/mean.

**skewness** is a measure of asymmetry. Close to 0 indicates that the
distribution is symmetrical around its mean. A positive number indicate
tail on the right, whereas a negative number means the opposite.

**kurtosis** describes the distribution tails where higher number
indicate the presence of outliers.

**IQR**\* (Inter quartile range) is the difference between the 3rd and
1st quartile (or 75th and 25th percentiles).

**MAD** ( median absolute deviation) is a more robust estimate the
standard deviation in the presence of outliers.

Temperature look symmetric and approximating to a Normal distribution

``` r
DWD_precipitation %>%
  mutate(quarters = factor(quarter(timestamp, fiscal_start = 1))) %>%
  ggplot() +
  geom_density(aes(air_temp, fill = quarters),
               alpha = 0.3, color = "white") +
  geom_vline(xintercept = 0, colour = "red", linetype = "dashed") +
  scale_fill_discrete_qualitative(name = "Quarter",
                                  palette = "Harmonic",# spacecolor package function
                                  labels = c("Jan-Mar", "Apr-Jun", "Jul-Sep", "Oct-Dec"))
```

![](2.3_Exploratory_analysis_files/figure-gfm/unnamed-chunk-17-1.png)<!-- -->

Try always to combine statistics with a plot

What about RH, is it symmetric?

``` r
DWD_precipitation %>%
  mutate(day_night = fct_collapse(sunlight_times, 
                                  "Day" = unique(sunlight_times)[-1])) %>%
  ggplot() +
  geom_density(aes(rel_humidity, fill = day_night), 
               alpha = 0.3, color = "white")
```

    ## Warning: Removed 133 rows containing non-finite values (stat_density).

![](2.3_Exploratory_analysis_files/figure-gfm/unnamed-chunk-18-1.png)<!-- -->

the difference between mean and med is a good indication when you don’t
remember specific statistics such as Skewness and Kurtosis

What about precipitation?

``` r
DWD_precipitation %>%
  ggplot() +
  geom_density(aes(precip_mm), alpha = 0.3, fill = "blue") +
  geom_vline(xintercept = 0, colour = "red", linetype = "dashed")
```

    ## Warning: Removed 1410 rows containing non-finite values (stat_density).

![](2.3_Exploratory_analysis_files/figure-gfm/unnamed-chunk-19-1.png)<!-- -->

**What a long tail**

Lets have a close look, plot only raining periods and up to 1mm

``` r
DWD_precipitation %>%
  filter(precip_h == 1) %>%
  ggplot() +
  geom_density(aes(precip_mm), alpha = 0.3, fill = "blue") +
  scale_x_continuous(name="mm", limits = c(0,1), breaks = c(seq(0,1,0.1))) +
  geom_vline(xintercept = 0, colour = "red", linetype = "dashed")
```

    ## Warning: Removed 3817 rows containing non-finite values (stat_density).

![](2.3_Exploratory_analysis_files/figure-gfm/unnamed-chunk-20-1.png)<!-- -->

**What is happening**, gotcha! the measurements system resolution is
only 0.1, so its not really continuous in a close look. you can check
using unique(DWD\_precipitation$precip\_mm)

Lets leave this discussion to extreme events analysis

There is only outliers

``` r
DWD_precipitation %>%
  filter(year(timestamp)==1999 | year(timestamp)==2019) %>%
  ggplot() +
  geom_boxplot(aes(y = precip_mm, x = factor(year(timestamp))), fill = "lightblue") 
```

    ## Warning: Removed 197 rows containing non-finite values (stat_boxplot).

![](2.3_Exploratory_analysis_files/figure-gfm/unnamed-chunk-21-1.png)<!-- -->

**There is only outliers!** outside the whiskers 1.5 × IQR

99.3% of the data falls in this interval. So every 1000 values that are
normally distributed, we expect to see about 7 outside of this range.

lets have a close look - excluding zeros and sum the m in a day

``` r
DWD_precipitation %>%
  filter(year(timestamp)==1999 | year(timestamp)==2019) %>%
  filter(precip_h == 1) %>%
  group_by(year = year(timestamp), doy = yday(timestamp)) %>%
  summarise(sum_mm = sum(precip_mm, na.rm = TRUE)) %>%
  #print(n=10)
  ggplot() +
  geom_boxplot(aes(y = sum_mm, x = factor(year)), fill = "lightblue") +
  scale_y_continuous(limits = c(0, 10))
```

    ## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.

    ## Warning: Removed 17 rows containing non-finite values (stat_boxplot).

![](2.3_Exploratory_analysis_files/figure-gfm/unnamed-chunk-22-1.png)<!-- -->

17 higher values was removed from the plot

variables like precipitation are challenging not only to present
outliers, but also to present many zero records. While the RH is limited
by zero (not in practical terms) and 100 with can also a problem, for
instance a ci may contain a upper limit above 100.

``` r
ggplot(DWD_precipitation, aes(sample = air_temp)) +
  stat_qq() + stat_qq_line()
```

![](2.3_Exploratory_analysis_files/figure-gfm/unnamed-chunk-23-1.png)<!-- -->

``` r
ggplot(DWD_precipitation, aes(sample = precip_mm)) + 
  stat_qq() + stat_qq_line()
```

    ## Warning: Removed 1410 rows containing non-finite values (stat_qq).

    ## Warning: Removed 1410 rows containing non-finite values (stat_qq_line).

![](2.3_Exploratory_analysis_files/figure-gfm/unnamed-chunk-24-1.png)<!-- -->

Correlation

``` r
DWD_precipitation %>%
  select_if(is.numeric) %>%
correlate(use = "pairwise.complete.obs", quiet = TRUE) 
```

    ## # A tibble: 7 x 8
    ##   term         precip_mm precip_h cloud_cover rel_humidity prec.window day_night
    ##   <chr>            <dbl>    <dbl>       <dbl>        <dbl>       <dbl>     <dbl>
    ## 1 precip_mm     NA         0.285       0.121         0.142     -0.0892    0.0128
    ## 2 precip_h       0.285    NA           0.392         0.313     -0.313    -0.0104
    ## 3 cloud_cover    0.121     0.392      NA             0.258     -0.325     0.0248
    ## 4 rel_humidity   0.142     0.313       0.258        NA         -0.371    -0.303 
    ## 5 prec.window   -0.0892   -0.313      -0.325        -0.371     NA         0.0377
    ## 6 day_night      0.0128   -0.0104      0.0248       -0.303      0.0377   NA     
    ## 7 air_temp       0.00655  -0.135      -0.0985       -0.567      0.191     0.319 
    ## # ... with 1 more variable: air_temp <dbl>

``` r
DWD_precipitation %>%
  select_if(is.numeric) %>%
  correlate( use = "pairwise.complete.obs", quiet = TRUE) %>%
  focus(air_temp)
```

    ## # A tibble: 6 x 2
    ##   term         air_temp
    ##   <chr>           <dbl>
    ## 1 precip_mm     0.00655
    ## 2 precip_h     -0.135  
    ## 3 cloud_cover  -0.0985 
    ## 4 rel_humidity -0.567  
    ## 5 prec.window   0.191  
    ## 6 day_night     0.319

``` r
DWD_precipitation %>%
  filter(year(timestamp) >= 2020) %>%
  mutate(day_night = fct_collapse(sunlight_times, 
                                  "Day" = unique(sunlight_times)[-1])) %>%
  ggpairs(mapping = aes(color = day_night), columns = c(2, 3, 5, 9))
```

    ## Warning in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    ## Removed 26 rows containing missing values

    ## Warning in ggally_statistic(data = data, mapping = mapping, na.rm = na.rm, :
    ## Removed 26 rows containing missing values

    ## Warning: Removed 26 rows containing missing values (geom_point).

    ## Warning: Removed 26 rows containing missing values (geom_point).

    ## Warning: Removed 26 rows containing non-finite values (stat_density).

    ## Warning: Removed 26 rows containing non-finite values (stat_boxplot).

    ## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
    ## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
    ## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.

    ## Warning: Removed 26 rows containing non-finite values (stat_bin).

![](2.3_Exploratory_analysis_files/figure-gfm/unnamed-chunk-27-1.png)<!-- -->

``` r
DWD_precipitation %>%
  filter(year(timestamp) >= 2020) %>%
  ggcorr(label = TRUE, label_alpha = TRUE)
```

    ## Warning in ggcorr(., label = TRUE, label_alpha = TRUE): data in column(s)
    ## 'timestamp', 'sunlight_times', 'cloud_type' are not numeric and were ignored

![](2.3_Exploratory_analysis_files/figure-gfm/unnamed-chunk-28-1.png)<!-- -->

``` r
DWD_precipitation %>%
  filter(year(timestamp) >= 2020 & month(timestamp) == 4) %>%
  mutate(day_night = fct_collapse(sunlight_times,
                                  "Day" = unique(sunlight_times)[-1])) %>%
  ggscatmat(columns = c("air_temp", "precip_mm", "rel_humidity"), color = "day_night", alpha = 0.8)
```

![](2.3_Exploratory_analysis_files/figure-gfm/unnamed-chunk-29-1.png)<!-- -->

Pearson’s correlation assumes the variables to be roughly normally
distributed and it is not robust in the presence of outliers. Check the
difference between Person and Spearman

``` r
DWD_precipitation %>%
  summarise(r = cor(air_temp, rel_humidity, use = 'pairwise.complete.obs')) %>% pull(r)
```

    ## [1] -0.5671673

Spearman method ranq x and y so it is less impacted by outliers

``` r
DWD_precipitation %>%
  summarise(r = cor(air_temp, rel_humidity, method = "spearman", use = 'pairwise.complete.obs')) %>% pull(r)
```

    ## [1] -0.5100821

There is not such a difference here

``` r
DWD_precipitation %>%
  summarise(r = cor(precip_mm, rel_humidity, use = 'pairwise.complete.obs')) %>% pull(r)
```

    ## [1] 0.1421374

``` r
DWD_precipitation %>% 
  summarise(r = cor(precip_mm, rel_humidity, method = "spearman", use = 'pairwise.complete.obs')) %>% pull(r)
```

    ## [1] 0.3289633

For precipitation the difference are noticeable

Spearman’s linear coefficient is appropriate for both quantitative and
ordinal variables. In addition rank based correlations are not dependent
on the normal distributional assumption and they are more resistant to
outliers

Non-linear correlations

``` r
mine(filter(DWD_precipitation, year(timestamp) >= 2020)[,2:5], na.rm = T)
```

    ## $MIC
    ##               precip_mm  precip_h cloud_cover rel_humidity
    ## precip_mm    0.38947153 0.2239866  0.04851942    0.1224928
    ## precip_h     0.22398656 0.6490904  0.10723239    0.1535287
    ## cloud_cover  0.04851942 0.1072324  0.99098611    0.1572445
    ## rel_humidity 0.12249277 0.1535287  0.15724446    0.9999999
    ## 
    ## $MAS
    ##                 precip_mm     precip_h cloud_cover rel_humidity
    ## precip_mm    0.000000e+00 8.881784e-16 0.006310359   0.04788057
    ## precip_h     8.881784e-16 0.000000e+00 0.014905672   0.08416047
    ## cloud_cover  6.310359e-03 1.490567e-02 0.000000000   0.06924746
    ## rel_humidity 4.788057e-02 8.416047e-02 0.069247463   0.00000000
    ## 
    ## $MEV
    ##               precip_mm  precip_h cloud_cover rel_humidity
    ## precip_mm    0.38947153 0.2239866  0.04851942    0.1224928
    ## precip_h     0.22398656 0.6490904  0.10723239    0.1535287
    ## cloud_cover  0.04851942 0.1072324  0.98578660    0.1572445
    ## rel_humidity 0.12249277 0.1535287  0.15724446    0.9999999
    ## 
    ## $MCN
    ##              precip_mm precip_h cloud_cover rel_humidity
    ## precip_mm            2        2           2            2
    ## precip_h             2        2           2            2
    ## cloud_cover          2        2           2            2
    ## rel_humidity         2        2           2            2
    ## 
    ## $MICR2
    ##                precip_mm    precip_h  cloud_cover  rel_humidity
    ## precip_mm    -0.61052847  0.10958717  0.037199109  9.820187e-02
    ## precip_h      0.10958717 -0.35090963  0.011335817  5.134306e-02
    ## cloud_cover   0.03719911  0.01133582 -0.009013889  6.342957e-02
    ## rel_humidity  0.09820187  0.05134306  0.063429573 -8.524262e-08
    ## 
    ## $GMIC
    ##               precip_mm  precip_h cloud_cover rel_humidity
    ## precip_mm    0.38947153 0.2239866  0.04850973    0.1160237
    ## precip_h     0.22398656 0.6490904  0.10721138    0.1380100
    ## cloud_cover  0.04850973 0.1072114  0.99097503    0.1375219
    ## rel_humidity 0.11602371 0.1380100  0.13752195    0.9999999
    ## 
    ## $TIC
    ##              precip_mm  precip_h cloud_cover rel_humidity
    ## precip_mm    614.96719  528.1603    67.93497     136.8613
    ## precip_h     528.16032 1530.5551   247.06640     253.9146
    ## cloud_cover   67.93497  247.0664  2216.47852     175.6923
    ## rel_humidity 136.86129  253.9146   175.69228    2357.9808
