Untitled
================
Alby
09/03/2021

## Example 2.1 Tidy Data

``` r
library(tidyverse)
```

    ## -- Attaching packages ------------------------------------------- tidyverse 1.3.0 --

    ## v ggplot2 3.3.3     v purrr   0.3.4
    ## v tibble  3.0.6     v dplyr   1.0.4
    ## v tidyr   1.1.2     v stringr 1.4.0
    ## v readr   1.4.0     v forcats 0.5.1

    ## -- Conflicts ---------------------------------------------- tidyverse_conflicts() --
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

``` r
library(lubridate)
```

    ## 
    ## Attaching package: 'lubridate'

    ## The following objects are masked from 'package:base':
    ## 
    ##     date, intersect, setdiff, union

### DWD precipitation dataset (prec)

**Download historical data** *file RR - id 03987 (Potsdam)*

`string::str_extract_all` and `string::str_split`

``` r
temp <- tempfile()
download.url <- "http://ftp-cdc.dwd.de/climate_environment/CDC/observations_germany/climate/hourly/precipitation/historical/"
zipfile <- readLines(download.url)
zipfile <- unlist(str_extract_all(zipfile, "stundenwerte_RR_03987_.+(.zip)"))
zipfile
```

    ## [1] "stundenwerte_RR_03987_19950901_20191231_hist.zip\">stundenwerte_RR_03987_19950901_20191231_hist.zip"

``` r
zipfile <- str_split(zipfile, ">")[[1]][2]
zipfile
```

    ## [1] "stundenwerte_RR_03987_19950901_20191231_hist.zip"

``` r
download.file(paste0(download.url,zipfile),temp, mode="wb")
metadata <- unzip(temp)
unlink(temp)
metadata 
```

    ##  [1] "./Metadaten_Fehldaten_03987_19950901_20191231.html"      
    ##  [2] "./Metadaten_Fehldaten_03987_19950901_20191231.txt"       
    ##  [3] "./Metadaten_Fehlwerte_03987_19950901_20191231.txt"       
    ##  [4] "./Metadaten_Fehlwerte_Gesamt_03987.txt"                  
    ##  [5] "./Metadaten_Geographie_03987.txt"                        
    ##  [6] "./Metadaten_Geraete_Niederschlag_Gefallen_Ind_03987.html"
    ##  [7] "./Metadaten_Geraete_Niederschlag_Gefallen_Ind_03987.txt" 
    ##  [8] "./Metadaten_Geraete_Niederschlagsform_03987.html"        
    ##  [9] "./Metadaten_Geraete_Niederschlagsform_03987.txt"         
    ## [10] "./Metadaten_Geraete_Niederschlagshoehe_03987.html"       
    ## [11] "./Metadaten_Geraete_Niederschlagshoehe_03987.txt"        
    ## [12] "./Metadaten_Parameter_rr_stunde_03987.html"              
    ## [13] "./Metadaten_Parameter_rr_stunde_03987.txt"               
    ## [14] "./Metadaten_Stationsname_03987.html"                     
    ## [15] "./Metadaten_Stationsname_03987.txt"                      
    ## [16] "./produkt_rr_stunde_19950901_20191231_03987.txt"

**Read historical data** `readr::read_delim`

``` r
dwd_prec <- read_delim(metadata[16], 
                       ";", escape_double = FALSE, 
                       col_types = cols(MESS_DATUM = col_datetime(format="%Y%m%d%H")), 
                       trim_ws = TRUE)
```

``` r
dwd_prec 
```

    ## # A tibble: 211,810 x 7
    ##    STATIONS_ID MESS_DATUM           QN_8    R1 RS_IND  WRTR eor  
    ##          <dbl> <dttm>              <dbl> <dbl>  <dbl> <dbl> <chr>
    ##  1        3987 1995-09-01 00:00:00     1   1.3      1  -999 eor  
    ##  2        3987 1995-09-01 01:00:00     1   1.7      1  -999 eor  
    ##  3        3987 1995-09-01 02:00:00     1   0.5      1  -999 eor  
    ##  4        3987 1995-09-01 03:00:00     1   0.5      1  -999 eor  
    ##  5        3987 1995-09-01 04:00:00     1   0.9      1  -999 eor  
    ##  6        3987 1995-09-01 05:00:00     1   1.1      1  -999 eor  
    ##  7        3987 1995-09-01 06:00:00     1   1.9      1  -999 eor  
    ##  8        3987 1995-09-01 07:00:00     1   1.1      1  -999 eor  
    ##  9        3987 1995-09-01 08:00:00     1   2        1  -999 eor  
    ## 10        3987 1995-09-01 09:00:00     1   0.3      1  -999 eor  
    ## # ... with 211,800 more rows

**Rename the variables/vectors/columns**

``` r
colnames(dwd_prec) <- c("id", "timestamp", "QN_8" , "precip_mm",
                        "prec_hour", "measure_form","eor")
```

\*\*convert the variable measure\_form to integer

``` r
dwd_prec$measure_form <- as.integer(dwd_prec$measure_form)
```

**Run variables summary to Check for NA or estrange values**

``` r
summary(dwd_prec)
```

    ##        id         timestamp                        QN_8      
    ##  Min.   :3987   Min.   :1995-09-01 00:00:00   Min.   :1.000  
    ##  1st Qu.:3987   1st Qu.:2001-11-13 09:15:00   1st Qu.:1.000  
    ##  Median :3987   Median :2007-12-01 08:30:00   Median :3.000  
    ##  Mean   :3987   Mean   :2007-11-23 20:03:54   Mean   :2.241  
    ##  3rd Qu.:3987   3rd Qu.:2013-12-15 19:45:00   3rd Qu.:3.000  
    ##  Max.   :3987   Max.   :2019-12-31 23:00:00   Max.   :3.000  
    ##    precip_mm           prec_hour          measure_form        eor           
    ##  Min.   :-999.0000   Min.   :-999.0000   Min.   :-999.0   Length:211810     
    ##  1st Qu.:   0.0000   1st Qu.:   0.0000   1st Qu.:-999.0   Class :character  
    ##  Median :   0.0000   Median :   0.0000   Median :   0.0   Mode  :character  
    ##  Mean   :  -0.7272   Mean   :  -0.5707   Mean   :-481.7                     
    ##  3rd Qu.:   0.0000   3rd Qu.:   0.0000   3rd Qu.:   0.0                     
    ##  Max.   :  31.7000   Max.   :   1.0000   Max.   :   8.0

**Convert -999.0000 and -999.0 to NA**

``` r
dwd_prec <- na_if(dwd_prec, -999)
```
